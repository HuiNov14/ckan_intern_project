{% extends "page.html" %}
{% block page_title %}

{% endblock %}
{% block breadcrumb_content_selected %}


{% endblock %}

{% block breadcrumb_content %}
{% snippet 'user/snippets/breadcrumd_statistical.html' %}
  <li class="statistical">
    <a href="/dashboard/statistical/resource-dashboard">{{ _('Resource Statistics') }}</a>
  </li>
  <li class="active">
    <a href="/dashboard/statistical/statistical-tracking">{{ _('Tracking Statistics') }}</a>
  </li>
{% endblock %}

{% block secondary %}{% endblock %}
{% block primary %}

{% asset 'api_tracking/dataset-css' %}
{% asset 'api_tracking/dataset-js' %}

<script>
  {% if urls_and_counts is not undefined and urls_and_counts is not none %}
      window.trackingData = {{ urls_and_counts | tojson }};
  {% else %}
      window.trackingData = [];
  {% endif %}
</script>
<div class="container my-4 px-3">
  <div class="container rounded ">
    <div class="d-flex justify-content-between">
      <h4 class="mb-4">{{ _("Filter Organization Datasets") }}</h4>
      <div class="col-md-4">
        {% snippet 'user/snippets/filter_chart_statistical.html' %}
      </div>
    </div>
    <hr class="mt-3" />
    <form class="formCss" id="tracking-form" action="{{ url_for('tracking_blueprint.statistical_tracking') }}" method="post">
      
      <div class="row mb-3">
        <div class="col-md-6">
            <label for="start_date" class="form-label">{{_("Start Date")}}</label>
            <input type="date" id="start_date" name="start_date" class="form-control" 
                  style="line-height: 2.5;" value="{{ start_date }}" max="{{ today }}">
            <div id="start-date-error" class="text-danger mt-1"></div>
        </div>
        <div class="col-md-6">
            <label for="end_date" class="form-label">{{_("End Date")}}</label>
            <input type="date" id="end_date" name="end_date" class="form-control" 
                  style="line-height: 2.5;" value="{{ end_date }}" max="{{ today }}">
            <div id="end-date-error" class="text-danger mt-1"></div>
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="package_name" class="form-label">{{_("Package Name")}}</label>
            <select id="package_name" name="package_name" class="form-select" multiple style="width: 100%;">
                <option value="" {% if package_name == [""] %}selected{% endif %}>{{ _("All Packages") }}</option>
                {% for dataset in all_datasets %}
                    <option value="{{ dataset }}" {% if dataset in package_name %}selected{% endif %}>
                        {{ dataset }}
                    </option>
                {% endfor %}
            </select>
        </div>
    
        <div class="col-md-6">
            <label for="user_name" class="form-label">{{_("User Name")}}</label>
            <select name="user_name" class="form-control select2"style="line-height: 2.5;">
                <option value="" {% if user_name == [""] %}selected{% endif %}>{{_("All User")}}</option>
                {% for user in user_all %}
                    <option value="{{ user.name }}" {% if user.name in user_name %}selected{% endif %}>
                        {{ user.display_name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>
    
      
      <div class="text-end">
          <button type="submit" class="btn btn-primary px-4">{{_("Filter")}}</button>
      </div>
    </form>
  </div>
  <div class="container mt-5 p-4 border rounded shadow-sm bg-light">
    <div id="packageTitle"></div>
    {% snippet 'user/snippets/sort_chart_statistical.html' %}
  </div>

  <!-- Resource Chart Section (Hidden Initially) -->
  <div id="resourceChartContainer">
    <h2 id="title_resource" >{{_("Resource Statistics")}}</h2>
    <canvas id="resourceChart"></canvas>
  </div>
  <div id="noResourceMessage" style="display: none; text-align: center; color: red; font-weight: bold;">
    {{_("No resources have been accessed.")}}
  </div>
</div>
</div>
</div>
  {% endblock %} 