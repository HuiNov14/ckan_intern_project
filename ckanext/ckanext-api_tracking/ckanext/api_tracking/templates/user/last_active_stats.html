{% extends "page.html" %}
{% block page_title %}

{% endblock %}
{% block breadcrumb_content_selected %}

{% endblock %}

{% block breadcrumb_content %}
{% snippet 'user/snippets/breadcrumd_statistical.html' %}
<li class="statistical">
  <a href="/dashboard/statistical/user-dashboard">{{ _('User Statistics') }}</a>
</li>
<li class="active">
  <a href="/dashboard/statistical/last_active_stats">{{ _('Last Active Statistics') }}</a>
</li>
{% endblock %}

{% block secondary %}{% endblock %}
{% block primary %}
{% asset 'api_tracking/dataset-css' %}
{% asset 'api_tracking/statistical_last_active-js' %}
<div class="container my-4 px-3">

  <div class="container rounded">
    <div class="d-flex justify-content-between">
      <h4 class="mb-4">{{ _("Last Active Statistics") }}</h4>
      <div class="col-md-4">
        {% snippet 'user/snippets/filter_chart_user_statistic.html' %}
      </div>
    </div>
    <hr class="mt-3" />
    <form class="formCss" id="tracking-form" action="{{ url_for('tracking_blueprint.last_active_statistical') }}"
      method="post">
      <div class="row mb-3">
        <div class="col-md-4">
          <label for="target_active_date" class="form-label">{{_("Target Date")}}</label>
          <input type="date" id="target_active_date" name="target_active_date" class="form-control"
            value="{{ target_active_date }}" max="{{ today }}">
          <div id="start-date-error" class="text-danger mt-1"></div>
        </div>
        <div class="col-md-4"> 
          <label for="recent_active_days" class="form-label">{{ _("Recent active days till the target date") }}</label>
          <select name="recent_active_days" class="form-select">
            <option value="{{ recent_active_days }}" {% if recent_active_days==None %}selected{% endif %}>{{ _("Select days") }}</option>
            {% for days in range(1, 31) %}
            <option value="{{ days }}" {% if days==recent_active_days %}selected{% endif %}>
              {{ days }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label for="sys_admin" class="form-label">{{ _("System admin") }}</label>
          <select name="sys_admin" class="form-select">
            <option value="true" {% if sys_admin=='true' %}selected{% endif %}>True</option>
            <option value="false" {% if sys_admin=='false' %}selected{% endif %}>False</option>
          </select>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary px-4">{{ _("Filter") }}</button>
        </div>
    </form>
  </div>

  <div class="container mt-5 p-4 border rounded shadow-sm bg-light">
    <div class="container">
      <canvas id="statisticsChart"></canvas>
    </div>
  </div>

  <!-- Dữ liệu datasets được inject vào đây -->
  <script>
    // Kiểm tra xem dữ liệu 'dataset_org' có được truyền thành công không
    {% if dataset_org %}
    window.trackingData = {{ dataset_org | safe }};
    {% else %}
    window.trackingData = [];
    {% endif %}
  </script>
  {% endblock %}