{% ckan_extends %}

{% block content_primary_nav %}
  <ul class="nav nav-tabs">
    {% block dashboard_nav_links %}
      {{ super() }}

      <link rel="stylesheet" href="/statistical.css" />
      <script src="{{ url_for('static', filename='') }}"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
      <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
      <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

      <script>
        $(document).ready(function () {
          // Áp dụng Select2 sau khi document đã sẵn sàng
          $('#package_name').select2({
            placeholder: 'Select package(s)', // Placeholder cho trường chọn
            allowClear: true // Cho phép xóa lựa chọn
          })
        })
        
        $('#package_name').on('select2:opening', function (e) {
          // Trigger AJAX load only when the input is clicked or about to open
          console.log('Opening Select2 dropdown, fetching data...')
          // You can manually call an AJAX function or refresh data here if needed
          // The AJAX call above should handle fetching the data automatically.
        })
      </script>



      <script>
        var $jq = jQuery.noConflict()
        $jq(document).ready(function () {
          $jq('#dataTable').DataTable()
        })
      </script>

      <script>
        function validateDates() {
          // Lấy giá trị của các trường start_date và end_date
          var startDate = document.getElementById('start_date').value
          var endDate = document.getElementById('end_date').value
        
          // Lấy phần tử để hiển thị lỗi
          var startDateError = document.getElementById('start-date-error')
          var endDateError = document.getElementById('end-date-error')
        
          // Xóa nội dung lỗi cũ (nếu có)
          startDateError.textContent = ''
          endDateError.textContent = ''
        
          // Kiểm tra ngày và hiện thông báo lỗi nếu không hợp lệ
          if (new Date(startDate) > new Date(endDate)) {
            startDateError.textContent = 'Start Date must be earlier than or equal to End Date.'
            endDateError.textContent = 'End Date must be later than or equal to Start Date.'
            return false // Ngăn chặn việc gửi form nếu có lỗi
          }
          return true
        }
      </script>


      {% include 'user/modal_template.html' %}
      <script>
        function setModalContent(button) {
          // Lấy dữ liệu từ thuộc tính data-* của nút nhấn
          var packageName = button.getAttribute('data-package-name')
          var packageView = button.getAttribute('data-package-view')
          var resources = JSON.parse(button.getAttribute('data-resources')) // Giả sử dữ liệu tài nguyên là một mảng JSON
        
          // Cập nhật tiêu đề modal
          document.getElementById('exampleModalLabel').textContent = 'Resources for ' + packageName
        
          // Xóa nội dung cũ trong bảng
          var tableBody = document.getElementById('resource-table-body')
          tableBody.innerHTML = '' // Làm trống bảng trước khi thêm nội dung mới
        
          // Thêm các tài nguyên vào bảng
          resources.forEach(function (resource) {
            var row = document.createElement('tr')
            var resourceNameCell = document.createElement('td')
            var downloadCountCell = document.createElement('td')
        
            resourceNameCell.textContent = resource.resource_name
            downloadCountCell.textContent = resource.download_count
        
            row.appendChild(resourceNameCell)
            row.appendChild(downloadCountCell)
        
            tableBody.appendChild(row)
          })
        }
      </script>
      

      {{ h.build_nav_icon('dashboard.statistical', h.humanize_entity_type('statistical', 'Statistical', 'label') or _('Statistical'), icon='users') }}
    {% endblock %}
  </ul>
{% endblock %}
